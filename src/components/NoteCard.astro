---
export type Note = {
  title: string;
  slug: string;
  description: string;
  cover: string;
  tags: string[];
  date: Date; // ISO: YYYY-MM-DD
};

type Props = {
  note: Note;
};

const { note } = Astro.props as Props;

// GitHub Pages 子路径（base）兼容：比如 "/repo-name/"
const base = import.meta.env.BASE_URL.replace(/\/$/, "");

const href = `${note.slug}/`;

// 封面：外链不动；以 / 开头的本地资源补 base
const cover =
  note.cover && note.cover.startsWith("/") ?  `${base}${note.cover}` : note.cover;

// 日期兜底
const dateText =
  note.date instanceof Date && !Number.isNaN(note.date.getTime())
    ? note.date.toLocaleDateString("zh-CN")
    : "";
---

<a class="card" href={href}>
  <div class="cover">
    {cover && (
      <img src={cover} alt={note.title} loading="lazy" decoding="async" />
    )}
    <div class="shade" aria-hidden="true"></div>

    <div class="meta">
      {dateText && <span class="date">{dateText}</span>}
    </div>
  </div>

  <div class="body">
    <h3 class="title">{note.title}</h3>
    <p class="description">{note.description}</p>

    <div class="tags" aria-label="tags">
      {note.tags.map((t) => (
        <span class="tag" data-tag={t}>{t}</span>
      ))}
    </div>
  </div>
</a>
